<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Web Component Data Grid Example</title>
  <style>
    html * {
      background: #111;
      color: #ddd;
      font-family: "Lucida Console";
    }

    foo-table {
      --foo-cell-border: 1px solid #555;
      --foo-cell-padding: 8pt;
      --foo-pager-background: #777;
    }

    foo-table::part(id) {
      width: 10%;
    }

    foo-table::part(name),
    foo-table::part(age),
    foo-table::part(location) {
      width: 30%;
    }
  </style>
</head>

<body>

  <foo-table websocket-url="ws://localhost:8023" rows="30" benchmark="true">
    <foo-column name="ID" key="id" type="string" is-guid="true"></foo-column>
    <foo-column name="Name" key="name" type="string"></foo-column>
    <foo-column name="Age" key="age" type="number"></foo-column>
    <foo-column name="Location" key="location" type="string"></foo-column>
  </foo-table>

  <script type="module">
    import './src/components/TableComponent.js';
    import './src/components/ColumnComponent.js';

    // An example of styling the cell when the shadow DOM is inaccessible to CSS.
    const reset_bg_after_ms = 10_000;
    const table = document.getElementsByTagName('foo-table')[0];
    const lastValuesById = new Map();
    const lastTimestampsById = new Map();

    table.registerColumnCallback('age', (newValue, row, cell) => {
      const rowId = row[table.idFieldName];
      const lastValue = lastValuesById.get(rowId) ?? 0;
      let rv;

      if (newValue > lastValue) {
        cell.style.background = 'green';
        rv = '▲ ' + newValue;
      }
      else if (newValue < lastValue) {
        cell.style.background = 'red';
        rv = '▼ ' + newValue;
      }
      else { // No change, do nothing unless reset_bg_after_ms has passed since the last change
        if (Date.now() - lastTimestampsById.get(rowId).timestamp > reset_bg_after_ms) {
          cell.style.background = 'unset';
          rv = String(newValue);
        }
      }

      lastValuesById.set(rowId, newValue);
      lastTimestampsById.set(rowId, Date.now());

      // Either: 
      // cell.innerText = newValue
      // Or return the value to have the cell updated:
      return rv;
    });

  </script>
</body>

</html>